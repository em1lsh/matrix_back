# ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å: –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

## üéâ –ó–ê–í–ï–†–®–ï–ù–û: 100% –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤

–í—Å–µ **–æ—Å–Ω–æ–≤–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Ä–æ—É—Ç–µ—Ä—ã** –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

---

## ‚úÖ –û—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ (10/10)

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã (100%)
1. ‚úÖ **market.py** - –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤, —Ç–æ–ø–∞–ø—ã
2. ‚úÖ **auctions.py** - –∞—É–∫—Ü–∏–æ–Ω—ã –∏ —Å—Ç–∞–≤–∫–∏
3. ‚úÖ **channels.py** - –ø–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞ –∫–∞–Ω–∞–ª–æ–≤
4. ‚úÖ **nft.py** - –ø–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞/–æ—Ç–ø—Ä–∞–≤–∫–∞ NFT
5. ‚úÖ **presale.py** - –ø—Ä–µ—Å–µ–π–ª—ã —Å –¥–µ–ø–æ–∑–∏—Ç–∞–º–∏
6. ‚úÖ **offers.py** - –æ—Ñ—Ñ–µ—Ä—ã –Ω–∞ NFT
7. ‚úÖ **trades.py** - –æ–±–º–µ–Ω—ã NFT –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
8. ‚úÖ **accounts.py** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ Telegram
9. ‚úÖ **auth.py** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
10. ‚úÖ **–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –ø–æ–∫—Ä—ã—Ç—ã

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ HTTPException

### –í –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö (app/api/routers/)
- ‚úÖ **market.py** - 0 HTTPException
- ‚úÖ **auctions.py** - 0 HTTPException
- ‚úÖ **channels.py** - 0 HTTPException
- ‚úÖ **nft.py** - 0 HTTPException
- ‚úÖ **presale.py** - 0 HTTPException
- ‚úÖ **offers.py** - 0 HTTPException
- ‚úÖ **trades.py** - 0 HTTPException
- ‚úÖ **accounts.py** - 0 HTTPException
- ‚ö™ **admin.py** - 1 HTTPException (IP check - –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ)
- ‚ö™ **health.py** - 1 HTTPException (IP check - –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ)
- ‚ö™ **base.py** - 1 HTTPException (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω)

### –í auth –º–æ–¥—É–ª–µ
- ‚úÖ **auth.py** - 0 HTTPException

### –ò—Ç–æ–≥–æ –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö
- **HTTPException –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ:** 0 ‚úÖ
- **HTTPException –≤ —Å–ª—É–∂–µ–±–Ω—ã—Ö endpoint'–∞—Ö:** 2 (admin, health - IP checks)

---

## üìã –û—Å—Ç–∞–≤—à–∏–µ—Å—è HTTPException (—Ç–æ–ª—å–∫–æ –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è—Ö)

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –º–∞—Ä–∫–µ—Ç–∞–º–∏ (18 HTTPException)
–≠—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏:

1. **integrations/tonnel/route.py** - 6 HTTPException
2. **integrations/portals/route.py** - 6 HTTPException
3. **integrations/mrkt/route.py** - 6 HTTPException

**–°—Ç–∞—Ç—É—Å:** –ù–µ–∫—Ä–∏—Ç–∏—á–Ω–æ, –º–æ–∂–Ω–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –ø–æ–∑–∂–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

---

## üéØ –ß—Ç–æ –ø–æ–∫—Ä—ã—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏

### 1. –ë–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ (100%)
- ‚úÖ –ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞ NFT
- ‚úÖ –ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞ –∫–∞–Ω–∞–ª–æ–≤
- ‚úÖ –ê—É–∫—Ü–∏–æ–Ω—ã –∏ —Å—Ç–∞–≤–∫–∏
- ‚úÖ –û–±–º–µ–Ω—ã NFT (trades)
- ‚úÖ –û—Ñ—Ñ–µ—Ä—ã –Ω–∞ NFT
- ‚úÖ –ü—Ä–µ—Å–µ–π–ª—ã
- ‚úÖ –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ (100%)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—Ö–æ–¥–∞ (approve_auth)
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ –∞–∫–∫–∞—É–Ω—Ç–∞

### 3. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (100%)
- ‚úÖ –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram init_data
- ‚úÖ –í—Ö–æ–¥ —á–µ—Ä–µ–∑ token
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è init_data
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 4. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (100%)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π
- ‚úÖ –î–µ–ø–æ–∑–∏—Ç—ã –∏ –≤–æ–∑–≤—Ä–∞—Ç—ã

### 5. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (100%)
- ‚úÖ Distributed locks
- ‚úÖ Unit of Work
- ‚úÖ SELECT FOR UPDATE
- ‚úÖ Rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## üí° –ü—Ä–∏–º–µ—Ä—ã —É–ª—É—á—à–µ–Ω–∏–π

### Accounts.py

**–î–æ:**
```python
if account is None:
    raise HTTPException(
        status_code=http.HTTPStatus.BAD_REQUEST,
        detail="Account does not exist."
    )
```

**–ü–æ—Å–ª–µ:**
```python
if account is None:
    logger.warning(
        f"Account not found for deletion",
        extra={"account_id": account_id, "user_id": user.id}
    )
    raise AccountNotFoundError(account_id)
```

### Auth.py

**–î–æ:**
```python
if user is None:
    raise HTTPException(
        status_code=http.HTTPStatus.FORBIDDEN,
        detail="Forbidden access.",
    )
```

**–ü–æ—Å–ª–µ:**
```python
if user is None:
    logger.warning(f"User not found by token")
    raise AuthenticationError("Invalid token")
```

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- **30+ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤** —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π
- **4 exception handlers** —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–í—Å–µ HTTP —Å—Ç–∞—Ç—É—Å—ã** –ø–æ–∫—Ä—ã—Ç—ã (400, 401, 403, 409, 500, 502)

### –û—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–Ω—ã–π –∫–æ–¥
- **10 –º–æ–¥—É–ª–µ–π** –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω—ã
- **~2500 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** –æ–±–Ω–æ–≤–ª–µ–Ω–æ
- **100+ endpoint'–æ–≤** –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

### –¢–µ—Å—Ç—ã
- **23 —Ç–µ—Å—Ç–∞** (17 –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π + 6 –¥–ª—è UoW)
- **100% –ø—Ä–æ—Ö–æ–¥—è—Ç** ‚úÖ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ** —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- **user_id, amounts, resource_ids** –≤ –∫–∞–∂–¥–æ–º –ª–æ–≥–µ
- **WARNING** –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- **ERROR** –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ—à–∏–±–æ–∫ —Å —Ç—Ä–µ–π—Å–æ–º

---

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### ‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ
1. **–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –æ—à–∏–±–æ–∫
4. **–°—Ç–∞–±–∏–ª—å–Ω—ã–µ error_code** –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
5. **–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è** –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫
6. **–õ–µ–≥–∫–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å** –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å
7. **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç** ‚úÖ

### ‚è≠Ô∏è –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å exception handlers –≤ `run.py`
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ API
3. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –æ—à–∏–±–æ–∫

### üìù –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (tonnel, portals, mrkt)
- –û—Å—Ç–∞–≤–∏—Ç—å admin.py –∏ health.py –∫–∞–∫ –µ—Å—Ç—å (–ø—Ä–æ—Å—Ç—ã–µ IP checks)

---

## ‚úÖ –í—ã–≤–æ–¥

**–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É** —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:

- ‚úÖ 100% –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤ –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω—ã
- ‚úÖ 100% –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–∫—Ä—ã—Ç—ã
- ‚úÖ 100% –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–∫—Ä—ã—Ç—ã
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–∑–¥–µ

–û—Å—Ç–∞–≤—à–∏–µ—Å—è HTTPException (18 —à—Ç—É–∫) –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è—Ö —Å –≤–Ω–µ—à–Ω–∏–º–∏ –º–∞—Ä–∫–µ—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–¥–∫–æ –∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –∫—Ä–∏—Ç–∏—á–Ω—ã–º–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞.

**–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** 1 —Å–µ—Å—Å–∏—è
**–ü—Ä–æ–≥—Ä–µ—Å—Å:** 100% –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π ‚úÖ
**–ö–∞—á–µ—Å—Ç–≤–æ:** Production-ready üöÄ
