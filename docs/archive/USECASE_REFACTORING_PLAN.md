# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞ Use Cases

## –ê–Ω–∞–ª–∏–∑ —Ç—è–∂–µ–ª—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

### üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

#### 1. **NFT Purchase** (`/nft/buy`) - –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
**–§–∞–π–ª:** `backend/project/app/api/routers/nft.py:82`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è NFT –∏ —Ü–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
- –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –º–∞—Ä–∫–µ—Ç–∞ (–≤—ã—á–∏—Ç–∞–Ω–∏–µ –∏–∑ —Ü–µ–Ω—ã)
- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–æ–¥–∞–≤—Ü—É (—Ü–µ–Ω–∞ - –∫–æ–º–∏—Å—Å–∏—è)
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ —Å–¥–µ–ª–∫–µ (NFTDeal)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
- –ü–µ—Ä–µ–Ω–æ—Å –≤–ª–∞–¥–µ–Ω–∏—è NFT
- –°–±—Ä–æ—Å —Ü–µ–Ω—ã NFT
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–∞ —á–µ—Ä–µ–∑ `sell_nft()`

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏)

---

#### 2. **Channel Purchase** (`/channels/buy`) - –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
**–§–∞–π–ª:** `backend/project/app/api/routers/channels.py:330`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞ –∏ —Ü–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram –∫–ª–∏–µ–Ω—Ç–∞
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö gifts –∫–∞–Ω–∞–ª–∞
- **–í–∞–ª–∏–¥–∞—Ü–∏—è gifts_hash** (–∑–∞—â–∏—Ç–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–∞–≤ –≤–ª–∞–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram API
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ UserNotMutualContactError
- –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü—É
- –°–æ–∑–¥–∞–Ω–∏–µ ChannelDeal
- –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ –∏–∑ –ø—Ä–æ–¥–∞–∂–∏
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `sell_channel()` –∏ `log_buy_channel()`

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è (–≤–Ω–µ—à–Ω–∏–π API, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –º–Ω–æ–≥–æ —à–∞–≥–æ–≤)

---

#### 3. **Presale Purchase** (`/presales/buy`) - –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
**–§–∞–π–ª:** `backend/project/app/api/routers/presale.py:191`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è presale
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ presale –Ω–µ –∫—É–ø–ª–µ–Ω (buyer_id == None)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ buyer_id

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (–ø—Ä–æ—Å—Ç–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)

---

#### 4. **Auction Bid** (`/auctions/bid`) - –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
**–§–∞–π–ª:** `backend/project/app/api/routers/auctions.py`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–∏ (start_bid)
- –í–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–≥–∞ —Å—Ç–∞–≤–∫–∏ (step_bid)
- **–í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–µ–¥—ã–¥—É—â–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º** (–≤—Å–µ bids)
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–∞–≤–∫–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ last_bid –∞—É–∫—Ü–∏–æ–Ω–∞
- –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ —Å –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è (–≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤, —Å–ª–æ–∂–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è)

---

#### 5. **Offer Accept** (`/offers/accept`) - –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
**–§–∞–π–ª:** `backend/project/app/api/routers/offers.py:95`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ—Ñ—Ñ–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –æ—Ñ—Ñ–µ—Ä–∞
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã (price –∏–ª–∏ reciprocal_price)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏
- –°–æ–∑–¥–∞–Ω–∏–µ NFTDeal
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
- –ü–µ—Ä–µ–Ω–æ—Å –≤–ª–∞–¥–µ–Ω–∏—è NFT
- –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `sell_nft()`

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (–ø–æ—Ö–æ–∂–µ –Ω–∞ NFT buy, –Ω–æ —Å –æ—Ñ—Ñ–µ—Ä–∞–º–∏)

---

#### 6. **Channel Add** (`/channels/new`) - –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
**–§–∞–π–ª:** `backend/project/app/api/routers/channels.py:46`

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram –∫–ª–∏–µ–Ω—Ç–∞
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ —á–µ—Ä–µ–∑ Telegram API
- –í–∞–ª–∏–¥–∞—Ü–∏—è —á—Ç–æ —ç—Ç–æ –∫–∞–Ω–∞–ª (–Ω–µ —á–∞—Ç)
- –í–∞–ª–∏–¥–∞—Ü–∏—è —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Å–æ–∑–¥–∞—Ç–µ–ª—å
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
- –ü–æ–ª—É—á–µ–Ω–∏–µ gifts –∫–∞–Ω–∞–ª–∞
- –†–∞—Å—á–µ—Ç gifts_hash
- –°–æ–∑–¥–∞–Ω–∏–µ Channel
- –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Gift –∏ ChannelGift –∑–∞–ø–∏—Å–µ–π
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å joinedload –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è (–≤–Ω–µ—à–Ω–∏–π API, —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ gifts)

---

### üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

#### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–∫—É–ø–∫–∏ (3-4 –¥–Ω—è)
1. **NFT Purchase** - —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
2. **Channel Purchase** - —Å–∞–º–∞—è —Å–ª–æ–∂–Ω–∞—è, —Å –≤–Ω–µ—à–Ω–∏–º API
3. **Offer Accept** - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–∫—É–ø–∫–∏ NFT

#### –§–∞–∑–∞ 2: –ê—É–∫—Ü–∏–æ–Ω—ã –∏ –æ—Ñ—Ñ–µ—Ä—ã (2-3 –¥–Ω—è)
4. **Auction Bid** - —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤
5. **Offer Create/Set Price** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ñ—Ñ–µ—Ä–æ–≤

#### –§–∞–∑–∞ 3: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (2 –¥–Ω—è)
6. **Channel Add** - —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å Telegram API
7. **Presale Set Price** - –ø—Ä–æ—Å—Ç–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è

---

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Use Cases

```
backend/project/app/
‚îú‚îÄ‚îÄ use_cases/              # NEW!
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ nft/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ buy_nft.py      # BuyNFTUseCase
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ set_price.py    # SetNFTPriceUseCase
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ return_nft.py   # ReturnNFTUseCase
‚îÇ   ‚îú‚îÄ‚îÄ channels/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ buy_channel.py  # BuyChannelUseCase
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ add_channel.py  # AddChannelUseCase
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ set_price.py    # SetChannelPriceUseCase
‚îÇ   ‚îú‚îÄ‚îÄ auctions/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create_auction.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ place_bid.py    # PlaceBidUseCase
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ finalize.py
‚îÇ   ‚îú‚îÄ‚îÄ offers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create_offer.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ accept_offer.py # AcceptOfferUseCase
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ set_price.py
‚îÇ   ‚îî‚îÄ‚îÄ presale/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ buy_presale.py  # BuyPresaleUseCase
‚îÇ       ‚îî‚îÄ‚îÄ set_price.py
```

---

## üìù –ü—Ä–∏–º–µ—Ä Use Case: BuyNFTUseCase

```python
# backend/project/app/use_cases/nft/buy_nft.py
from decimal import Decimal
from app.db.uow import UnitOfWork
from app.exceptions import (
    NFTNotFoundError,
    InsufficientBalanceError,
)
from app.bot.functions import sell_nft
from app.configs import settings


class BuyNFTUseCase:
    """
    Use Case: –ü–æ–∫—É–ø–∫–∞ NFT
    
    –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞:
    1. NFT –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏ –∏–º–µ—Ç—å —Ü–µ–Ω—É
    2. –£ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
    3. –ö–æ–º–∏—Å—Å–∏—è –º–∞—Ä–∫–µ—Ç–∞ –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ —Ü–µ–Ω—ã
    4. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –æ —Å–¥–µ–ª–∫–µ
    5. –ü—Ä–æ–¥–∞–≤–µ—Ü –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    """
    
    def __init__(self, uow: UnitOfWork):
        self.uow = uow
    
    async def execute(self, nft_id: int, buyer_id: int) -> dict:
        """
        –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∫—É–ø–∫—É NFT
        
        Args:
            nft_id: ID NFT –¥–ª—è –ø–æ–∫—É–ø–∫–∏
            buyer_id: ID –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
            
        Returns:
            dict: –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
            
        Raises:
            NFTNotFoundError: NFT –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
            InsufficientBalanceError: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
        """
        async with self.uow:
            # 1. –ü–æ–ª—É—á–∏—Ç—å NFT —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π (SELECT FOR UPDATE)
            nft = await self.uow.nfts.get_for_purchase(nft_id)
            if not nft or not nft.price or nft.account_id:
                raise NFTNotFoundError(nft_id)
            
            # 2. –ü–æ–ª—É—á–∏—Ç—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
            buyer = await self.uow.users.get(buyer_id)
            if buyer.market_balance < nft.price:
                raise InsufficientBalanceError(
                    required=nft.price,
                    available=buyer.market_balance
                )
            
            # 3. –†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏
            commission = round(nft.price / 100 * settings.market_comission)
            seller_amount = nft.price - commission
            
            # 4. –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É
            deal = await self.uow.nft_deals.create(
                gift_id=nft.gift_id,
                seller_id=nft.user_id,
                buyer_id=buyer.id,
                price=nft.price
            )
            
            # 5. –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å—ã
            await self.uow.users.update_balance(
                buyer.id,
                -nft.price
            )
            await self.uow.users.update_balance(
                nft.user_id,
                seller_amount
            )
            
            # 6. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤–ª–∞–¥–µ–Ω–∏–µ
            await self.uow.nfts.transfer_ownership(
                nft.id,
                new_owner_id=buyer.id,
                reset_price=True
            )
            
            # 7. Commit —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            await self.uow.commit()
            
            # 8. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
            seller = await self.uow.users.get(nft.user_id)
            await sell_nft(
                gift_title=nft.gift.title,
                price=seller_amount / 1e9,
                user_id=seller.id,
                lang_code=seller.language
            )
            
            return {
                "success": True,
                "deal_id": deal.id,
                "nft_id": nft.id
            }
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Use Cases

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Use Cases:
1. **–ò–∑–æ–ª—è—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏** - —Ç–µ—Å—Ç–∏—Ä—É–µ–º –±–µ–∑ HTTP
2. **–ú–æ–∫–∏ UoW** - –Ω–µ –Ω—É–∂–Ω–∞ —Ä–µ–∞–ª—å–Ω–∞—è –ë–î
3. **–ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã** - unit —Ç–µ—Å—Ç—ã –≤–º–µ—Å—Ç–æ integration
4. **–ü–æ–∫—Ä—ã—Ç–∏–µ edge cases** - –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞:

```python
# backend/tests/use_cases/test_buy_nft.py
import pytest
from unittest.mock import AsyncMock, Mock
from app.use_cases.nft.buy_nft import BuyNFTUseCase
from app.exceptions import NFTNotFoundError, InsufficientBalanceError


@pytest.mark.asyncio
async def test_buy_nft_success():
    """–£—Å–ø–µ—à–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ NFT"""
    # Arrange
    uow = AsyncMock()
    nft = Mock(
        id=1,
        price=1000000000,  # 1 TON
        user_id=2,
        gift_id=10,
        account_id=None
    )
    buyer = Mock(id=3, market_balance=2000000000)
    
    uow.nfts.get_for_purchase.return_value = nft
    uow.users.get.return_value = buyer
    
    use_case = BuyNFTUseCase(uow)
    
    # Act
    result = await use_case.execute(nft_id=1, buyer_id=3)
    
    # Assert
    assert result["success"] is True
    uow.commit.assert_called_once()
    uow.users.update_balance.assert_any_call(3, -1000000000)


@pytest.mark.asyncio
async def test_buy_nft_insufficient_balance():
    """–ü–æ–∫—É–ø–∫–∞ NFT —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º"""
    # Arrange
    uow = AsyncMock()
    nft = Mock(id=1, price=1000000000, account_id=None)
    buyer = Mock(id=3, market_balance=500000000)  # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
    
    uow.nfts.get_for_purchase.return_value = nft
    uow.users.get.return_value = buyer
    
    use_case = BuyNFTUseCase(uow)
    
    # Act & Assert
    with pytest.raises(InsufficientBalanceError):
        await use_case.execute(nft_id=1, buyer_id=3)
    
    uow.commit.assert_not_called()
```

---

## üìã –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1 –¥–µ–Ω—å)
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ `use_cases/`
- [ ] –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `BaseUseCase`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å UoW —Å –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è use cases
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DI –¥–ª—è use cases

### –≠—Ç–∞–ø 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ NFT (1 –¥–µ–Ω—å)
- [ ] –°–æ–∑–¥–∞—Ç—å `BuyNFTUseCase`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è `BuyNFTUseCase`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ—É—Ç `/nft/buy` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è use case
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å ref tests –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è

### –≠—Ç–∞–ø 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Channels (2 –¥–Ω—è)
- [ ] –°–æ–∑–¥–∞—Ç—å `BuyChannelUseCase`
- [ ] –°–æ–∑–¥–∞—Ç—å `AddChannelUseCase`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ—É—Ç—ã
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å ref tests

### –≠—Ç–∞–ø 4: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Auctions (1 –¥–µ–Ω—å)
- [ ] –°–æ–∑–¥–∞—Ç—å `PlaceBidUseCase`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ—É—Ç
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å ref tests

### –≠—Ç–∞–ø 5: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Offers (1 –¥–µ–Ω—å)
- [ ] –°–æ–∑–¥–∞—Ç—å `AcceptOfferUseCase`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ—É—Ç
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å ref tests

### –≠—Ç–∞–ø 6: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (1 –¥–µ–Ω—å)
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ ref tests
- [ ] –°—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (load tests)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] Code review

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

1. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å** - –≤—Å–µ ref tests –ø—Ä–æ—Ö–æ–¥—è—Ç
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–∏–ª–∞—Å—å** - load tests –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–∫–æ—Ä–µ–Ω–∏–µ
3. **–ö–æ–¥ —Å—Ç–∞–ª —á–∏—â–µ** - —Ä–æ—É—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ HTTP –ª–æ–≥–∏–∫—É
4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - unit —Ç–µ—Å—Ç—ã –¥–ª—è use cases
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –∫–∞–∂–¥—ã–π use case –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Ä–∞–±–æ—á—É—é –≤–µ—Ç–∫—É
2. –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—ã–π use case (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é `BuyNFTUseCase`)
3. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–æ–¥ —Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
4. –°–æ–∑–¥–∞—Ç—å use case
5. –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ—É—Ç
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å ref tests –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
