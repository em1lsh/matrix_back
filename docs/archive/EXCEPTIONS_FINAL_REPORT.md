# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≥—Ä–µ—Å—Å: 75% (6/8 —Ä–æ—É—Ç–µ—Ä–æ–≤)

**‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ:**
- –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: 100%
- –¢–µ—Å—Ç—ã: 100% (23/23 –ø—Ä–æ—Ö–æ–¥—è—Ç)
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã: 100%

**‚è≥ –û—Å—Ç–∞–ª–æ—Å—å:**
- trades.py - –æ–±–º–µ–Ω—ã NFT
- accounts.py - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

---

## üéØ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (100%)

#### –ò–µ—Ä–∞—Ä—Ö–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π (30+ –∫–ª–∞—Å—Å–æ–≤)
```
AppException (–±–∞–∑–æ–≤–æ–µ)
‚îú‚îÄ‚îÄ BusinessLogicError (400)
‚îÇ   ‚îú‚îÄ‚îÄ ResourceNotFoundError
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NFTNotFoundError
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChannelNotFoundError
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AccountNotFoundError
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuctionNotFoundError
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PresaleNotFoundError
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OfferNotFoundError
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TradeNotFoundError
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProposalNotFoundError
‚îÇ   ‚îú‚îÄ‚îÄ ResourceAlreadyExistsError
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuctionAlreadyExistsError
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OfferAlreadyExistsError
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProposalAlreadyExistsError
‚îÇ   ‚îú‚îÄ‚îÄ InsufficientBalanceError
‚îÇ   ‚îî‚îÄ‚îÄ InvalidOperationError
‚îÇ       ‚îú‚îÄ‚îÄ ChannelHasNoGiftsError
‚îÇ       ‚îú‚îÄ‚îÄ NotChannelCreatorError
‚îÇ       ‚îú‚îÄ‚îÄ NotChannelError
‚îÇ       ‚îú‚îÄ‚îÄ AccountTooNewError
‚îÇ       ‚îú‚îÄ‚îÄ ChannelGiftsModifiedError
‚îÇ       ‚îú‚îÄ‚îÄ TradeRequirementsNotMetError
‚îÇ       ‚îú‚îÄ‚îÄ BidTooLowError
‚îÇ       ‚îî‚îÄ‚îÄ AuctionExpiredError
‚îú‚îÄ‚îÄ AuthenticationError (401)
‚îÇ   ‚îî‚îÄ‚îÄ InvalidInitDataError
‚îú‚îÄ‚îÄ PermissionDeniedError (403)
‚îÇ   ‚îî‚îÄ‚îÄ NotResourceOwnerError
‚îú‚îÄ‚îÄ ResourceConflictError (409)
‚îÇ   ‚îú‚îÄ‚îÄ ResourceLockedError
‚îÇ   ‚îî‚îÄ‚îÄ LockTimeoutError
‚îú‚îÄ‚îÄ ExternalServiceError (502)
‚îÇ   ‚îú‚îÄ‚îÄ TelegramAPIError
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserNotMutualContactError
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChannelTransferFailedError
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GiftSendFailedError
‚îÇ   ‚îî‚îÄ‚îÄ TONWalletError
‚îÇ       ‚îî‚îÄ‚îÄ WithdrawalFailedError
‚îî‚îÄ‚îÄ DatabaseError (500)
    ‚îú‚îÄ‚îÄ TransactionError
    ‚îî‚îÄ‚îÄ CommitAfterRollbackError
```

#### Exception Handlers
- `app_exception_handler` - –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- `http_exception_handler` - –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- `validation_exception_handler` - Pydantic –æ—à–∏–±–∫–∏
- `generic_exception_handler` - fallback –¥–ª—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

#### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
- `app/db/uow.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- `app/utils/locks.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `LockTimeoutError`

---

### 2. –¢–µ—Å—Ç—ã (100%)

**17 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π:**
- –ë–∞–∑–æ–≤—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- –†–µ—Å—É—Ä—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
- –†–µ—Å—É—Ä—Å—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤
- –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –ò–µ—Ä–∞—Ä—Ö–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π

**6 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è UoW:**
- Commit success
- Auto rollback on exception
- Auto rollback without commit
- Flush without commit
- Cannot commit after rollback
- Complex transaction

**–í—Å–µ 23 —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç ‚úÖ**

---

### 3. –û—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã (6/8)

#### ‚úÖ market.py
**Endpoints:**
- `output()` - –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `InsufficientBalanceError` - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
- `WithdrawalFailedError` - –æ—à–∏–±–∫–∞ –≤—ã–≤–æ–¥–∞ TON

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ù–∞—á–∞–ª–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–≤–æ–¥–∞
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å (WARNING)
- –û—à–∏–±–∫–∏ TON wallet (ERROR —Å —Ç—Ä–µ–π—Å–æ–º)
- –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ (INFO)

#### ‚úÖ auctions.py
**Endpoints:**
- `new_auction()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞
- `delete_auction()` - —É–¥–∞–ª–µ–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞
- `new_bid()` - —Å—Ç–∞–≤–∫–∞ –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `NFTNotFoundError`
- `AuctionNotFoundError`
- `AuctionAlreadyExistsError`
- `InsufficientBalanceError`
- `BidTooLowError`

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞
- –°—Ç–∞–≤–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏ (user_id, amounts)
- –û—à–∏–±–∫–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

#### ‚úÖ channels.py (—Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π)
**Endpoints:**
- `add_channel()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞
- `set_price()` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω—ã
- `buy_channel()` - –ø–æ–∫—É–ø–∫–∞ –∫–∞–Ω–∞–ª–∞ (–∫—Ä–∏—Ç–∏—á–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `AccountNotFoundError`
- `ChannelNotFoundError`
- `NotChannelError`
- `NotChannelCreatorError`
- `ChannelHasNoGiftsError`
- `AccountTooNewError`
- `InsufficientBalanceError`
- `ChannelGiftsModifiedError`
- `UserNotMutualContactError`
- `ChannelTransferFailedError`

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í—Å–µ —ç—Ç–∞–ø—ã –ø–æ–∫—É–ø–∫–∏ –∫–∞–Ω–∞–ª–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ gifts_hash
- –ü–µ—Ä–µ–¥–∞—á–∞ —á–µ—Ä–µ–∑ Telegram API
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –û—à–∏–±–∫–∏ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

#### ‚úÖ nft.py
**Endpoints:**
- `set_price_nft()` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω—ã
- `buy_nft()` - –ø–æ–∫—É–ø–∫–∞ NFT

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `NFTNotFoundError`
- `InsufficientBalanceError`

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã
- –ü–æ–∫—É–ø–∫–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏ (buyer, seller, price, commission)
- –ù–æ–≤—ã–µ –±–∞–ª–∞–Ω—Å—ã

#### ‚úÖ presale.py
**Endpoints:**
- `set_price()` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω—ã (—Å –¥–µ–ø–æ–∑–∏—Ç–æ–º 20%)
- `delete_presale()` - —É–¥–∞–ª–µ–Ω–∏–µ (–≤–æ–∑–≤—Ä–∞—Ç –¥–µ–ø–æ–∑–∏—Ç–∞)
- `buy_presale()` - –ø–æ–∫—É–ø–∫–∞

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `PresaleNotFoundError`
- `InsufficientBalanceError`

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –î–µ–ø–æ–∑–∏—Ç –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Ü–µ–Ω—ã
- –í–æ–∑–≤—Ä–∞—Ç –¥–µ–ø–æ–∑–∏—Ç–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
- –ü–æ–∫—É–ø–∫–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏

#### ‚úÖ offers.py
**Endpoints:**
- `new_offer()` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–∞
- `refuse_offer()` - –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–∞
- `accept_offer()` - –ø—Ä–∏–Ω—è—Ç–∏–µ –æ—Ñ—Ñ–µ—Ä–∞

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `OfferNotFoundError`
- `OfferAlreadyExistsError`
- `InsufficientBalanceError`

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–æ–≤
- –ü—Ä–∏–Ω—è—Ç–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏ —Å–¥–µ–ª–∫–∏
- –ö–æ–º–∏—Å—Å–∏–∏ –∏ –±–∞–ª–∞–Ω—Å—ã

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
```python
# –ü—Ä–æ–±–ª–µ–º—ã:
raise HTTPException(
    status_code=http.HTTPStatus.BAD_REQUEST,
    detail="Insufficient balance."  # –°—Ç—Ä–æ–∫–∞ –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
)
```

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
```python
# –†–µ—à–µ–Ω–∏–µ:
logger.warning(
    f"Insufficient balance for NFT purchase",
    extra={
        "user_id": user.id,
        "nft_id": nft_id,
        "required": nft.price,
        "available": user.market_balance
    }
)
raise InsufficientBalanceError(
    required=nft.price,
    available=user.market_balance
)
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. **–¢–∏–ø–∏–∑–∞—Ü–∏—è**
   - –ë—ã–ª–æ: —Å—Ç—Ä–æ–∫–∏ –≤ HTTPException
   - –°—Ç–∞–ª–æ: —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π

2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ë—ã–ª–æ: –Ω–µ—Ç –ª–æ–≥–æ–≤ –∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ
   - –°—Ç–∞–ª–æ: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

3. **–û—Ç–ª–∞–¥–∫–∞**
   - –ë—ã–ª–æ: —Å–ª–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏
   - –°—Ç–∞–ª–æ: –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –ª–æ–≥–∞—Ö (user_id, amounts, resource_ids)

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –ë—ã–ª–æ: –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏
   - –°—Ç–∞–ª–æ: –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ç–∏–ø—ã –æ—à–∏–±–æ–∫

5. **–§—Ä–æ–Ω—Ç–µ–Ω–¥**
   - –ë—ã–ª–æ: –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –°—Ç–∞–ª–æ: —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫ (error_code)

---

## üîç –ü—Ä–∏–º–µ—Ä—ã —É–ª—É—á—à–µ–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–∫—É–ø–∫–∞ NFT

**–î–æ:**
```python
if user.market_balance < nft.price:
    raise HTTPException(
        status_code=http.HTTPStatus.BAD_REQUEST,
        detail="Insufficient balance."
    )
```

**–ü–æ—Å–ª–µ:**
```python
if user.market_balance < nft.price:
    logger.warning(
        f"Insufficient balance for NFT purchase",
        extra={
            "user_id": user.id,
            "nft_id": nft_id,
            "required": nft.price,
            "available": user.market_balance
        }
    )
    raise InsufficientBalanceError(
        required=nft.price,
        available=user.market_balance
    )
```

**–ü–æ–ª—å–∑–∞:**
- –í–∏–¥–Ω–æ –∫—Ç–æ –ø—ã—Ç–∞–ª—Å—è –∫—É–ø–∏—Ç—å (user_id)
- –í–∏–¥–Ω–æ —á—Ç–æ –ø—ã—Ç–∞–ª–∏—Å—å –∫—É–ø–∏—Ç—å (nft_id)
- –í–∏–¥–Ω–æ —Å–∫–æ–ª—å–∫–æ –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ (required vs available)
- –ú–æ–∂–Ω–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫—É —Å—Ä–µ–¥—Å—Ç–≤

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–∫—É–ø–∫–∞ –∫–∞–Ω–∞–ª–∞

**–î–æ:**
```python
if gifts_hash != channel.gifts_hash:
    raise HTTPException(
        status_code=http.HTTPStatus.BAD_REQUEST,
        detail="The channel's gifts have been modified."
    )
```

**–ü–æ—Å–ª–µ:**
```python
if gifts_hash != channel.gifts_hash:
    logger.warning(
        f"Channel gifts modified since listing",
        extra={
            "channel_id": channel_id,
            "expected_hash": channel.gifts_hash,
            "actual_hash": gifts_hash,
            "seller_id": channel.user_id
        }
    )
    raise ChannelGiftsModifiedError(channel_id)
```

**–ü–æ–ª—å–∑–∞:**
- –í–∏–¥–Ω–æ –∫–∞–∫–æ–π –∫–∞–Ω–∞–ª (channel_id)
- –í–∏–¥–Ω–æ —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (hash comparison)
- –í–∏–¥–Ω–æ –∫—Ç–æ –ø—Ä–æ–¥–∞–≤–µ—Ü (seller_id)
- –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø–æ–ø—ã—Ç–∫–∏ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞

### –ü—Ä–∏–º–µ—Ä 3: –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤

**–î–æ:**
```python
except Exception as e:
    logging.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ TON: {e}")
    raise HTTPException(
        status_code=http.HTTPStatus.INTERNAL_SERVER_ERROR,
        detail=f"Withdrawal failed: {str(e)}"
    )
```

**–ü–æ—Å–ª–µ:**
```python
except Exception as e:
    logger.error(
        f"TON withdrawal failed",
        extra={
            "user_id": user.id,
            "amount": ton_amount,
            "address": address,
            "error": str(e)
        },
        exc_info=True
    )
    raise WithdrawalFailedError(str(e))
```

**–ü–æ–ª—å–∑–∞:**
- –ü–æ–ª–Ω—ã–π —Ç—Ä–µ–π—Å –æ—à–∏–±–∫–∏ (exc_info=True)
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ (user, amount, address)
- –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
- –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å TON wallet

---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `backend/project/app/exceptions/__init__.py` - 450 —Å—Ç—Ä–æ–∫
2. `backend/project/app/api/exception_handlers.py` - 200 —Å—Ç—Ä–æ–∫
3. `backend/tests/test_exceptions.py` - 200 —Å—Ç—Ä–æ–∫
4. `backend/docs/EXCEPTIONS_ANALYSIS.md` - –∞–Ω–∞–ª–∏–∑
5. `backend/docs/EXCEPTIONS_IMPLEMENTATION_PROGRESS.md` - –ø—Ä–æ–≥—Ä–µ—Å—Å
6. `backend/docs/EXCEPTIONS_FINAL_REPORT.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `backend/project/app/db/uow.py`
2. `backend/project/app/utils/locks.py`
3. `backend/project/app/api/routers/market.py`
4. `backend/project/app/api/routers/auctions.py`
5. `backend/project/app/api/routers/channels.py`
6. `backend/project/app/api/routers/nft.py`
7. `backend/project/app/api/routers/presale.py`
8. `backend/project/app/api/routers/offers.py`
9. `backend/tests/test_uow.py`

---

## ‚è≠Ô∏è –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å

### 1. trades.py (—Å–ª–æ–∂–Ω—ã–π —Ä–æ—É—Ç–µ—Ä)
- –û–±–º–µ–Ω—ã NFT –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞ (proposals)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π —Ç—Ä–µ–π–¥–∞
- –ö–æ–º–∏—Å—Å–∏–∏ –∑–∞ –æ–±–º–µ–Ω

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:**
- `TradeNotFoundError`
- `ProposalNotFoundError`
- `ProposalAlreadyExistsError`
- `TradeRequirementsNotMetError`
- `NFTsNotFoundError`
- `InsufficientBalanceError`

### 2. accounts.py
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:**
- `AuthenticationError`
- `InvalidInitDataError`

### 3. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è handlers
- –û–±–Ω–æ–≤–∏—Ç—å `project/run.py`
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å `register_exception_handlers(app)`
- –î–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è request context

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ API
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç—ã –æ—à–∏–±–æ–∫

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –û–±–Ω–æ–≤–∏—Ç—å API docs —Å –∫–æ–¥–∞–º–∏ –æ—à–∏–±–æ–∫
- –°–æ–∑–¥–∞—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –û–±–Ω–æ–≤–∏—Ç—å README

---

## üéâ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- ‚úÖ –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫

### –û—Ç–ª–∞–¥–∫–∞
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –ª–æ–≥–∞—Ö
- ‚úÖ –¢—Ä–µ–π—Å—ã –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –ú–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–æ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫
- ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ú–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–¥—ã

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

---

## üìä –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ò–µ—Ä–∞—Ä—Ö–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π:** 30+ –∫–ª–∞—Å—Å–æ–≤
- **Exception handlers:** 4 –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
- **–¢–µ—Å—Ç—ã:** 23 —Ç–µ—Å—Ç–∞ (100% –ø—Ä–æ—Ö–æ–¥—è—Ç)
- **–û—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–æ —Ä–æ—É—Ç–µ—Ä–æ–≤:** 6/8 (75%)
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~1500 —Å—Ç—Ä–æ–∫
- **–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** 1 —Å–µ—Å—Å–∏—è
- **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–∫—Ä—ã—Ç—ã:** 100%

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** trades.py –∏ accounts.py
2. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å handlers** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** —á–µ—Ä–µ–∑ API
4. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
5. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –º–µ—Ç—Ä–∏–∫ –æ—à–∏–±–æ–∫
6. **–î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã** –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

---

## üí° –í—ã–≤–æ–¥—ã

–í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏–ª–æ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:

1. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** - –∫–æ–¥ —Å—Ç–∞–ª –ø–æ–Ω—è—Ç–Ω–µ–µ
2. **–û—Ç–ª–∞–¥–∫–∞** - –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏
4. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** - –ø—Ä–æ—â–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫
5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∫–æ–¥—ã

–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫.
