# –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–µ–π –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ - 3 –¥–µ–∫–∞–±—Ä—è 2024

## 1. –ö–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π: 9/10

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

#### 1.1 –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (10/10)
```python
# –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
id = Column(Integer, primary_key=True)
price = Column(BigInteger, nullable=True)

# –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
id: Mapped[int] = mapped_column(primary_key=True, autoincrement=True)
price: Mapped[Optional[int]] = mapped_column(BigInteger, nullable=True, comment="–¶–µ–Ω–∞ –≤ nanotons")
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ type hints –¥–ª—è IDE –∏ mypy
- –ê–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ
- –û—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –ª–æ–≤—è—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ Optional –¥–ª—è nullable –ø–æ–ª–µ–π

#### 1.2 –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è (9/10)
```python
__table_args__ = (
    Index('ix_nfts_user_price', 'user_id', 'price'),  # –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å
    Index('ix_nfts_gift_price', 'gift_id', 'price'),  # –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    Index('ix_nfts_price_not_null', 'price', postgresql_where=text('price IS NOT NULL')),  # –ß–∞—Å—Ç–∏—á–Ω—ã–π
    CheckConstraint('price >= 0', name='check_nft_price_positive'),
)
```

**–î–æ–±–∞–≤–ª–µ–Ω–æ –∏–Ω–¥–µ–∫—Å–æ–≤:**
- Single-column: ~40 –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ FK –∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è
- Composite: ~30 —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è JOIN –∏ WHERE
- Partial: ~5 —á–∞—Å—Ç–∏—á–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- Unique: ~10 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

**–ü–æ–∫—Ä—ã—Ç–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤:** ~95%

#### 1.3 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (9/10)
```python
class NFT(Base):
    """
    –ú–æ–¥–µ–ª—å NFT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    
    Attributes:
        id: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä NFT
        gift_id: ID –ø–æ–¥–∞—Ä–∫–∞ Telegram
        user_id: ID –≤–ª–∞–¥–µ–ª—å—Ü–∞
        price: –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –≤ nanotons (NULL –µ—Å–ª–∏ –Ω–µ –ø—Ä–æ–¥–∞–µ—Ç—Å—è)
        msg_id: ID —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–¥–∞—Ä–∫–æ–º
    """
```

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
- Docstrings –¥–ª—è –≤—Å–µ—Ö 25 –º–æ–¥–µ–ª–µ–π
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ–ª—è–º —á–µ—Ä–µ–∑ `comment`
- –û–ø–∏—Å–∞–Ω–∏–µ relationships
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö

#### 1.4 Constraints –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è (8/10)
```python
# CheckConstraints
CheckConstraint('price >= 0', name='check_nft_price_positive')
CheckConstraint('start_bid > 0', name='check_auction_start_bid_positive')

# NOT NULL –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
gift_id: Mapped[int] = mapped_column(BigInteger, nullable=False)

# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ ondelete
user_id: Mapped[int] = mapped_column(ForeignKey('users.id', ondelete='CASCADE'))
seller_id: Mapped[Optional[int]] = mapped_column(ForeignKey('users.id', ondelete='SET NULL'))
```

**–ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ:**
- –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø–æ–º–µ—á–µ–Ω—ã `nullable=False`
- CheckConstraints –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ ondelete –¥–ª—è FK
- Server defaults –≥–¥–µ –Ω—É–∂–Ω–æ

#### 1.5 Relationships (8/10)
```python
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ relationships
nfts: Mapped[List["NFT"]] = relationship(
    "NFT", 
    back_populates="user",
    cascade="all, delete-orphan",
    lazy='noload'  # –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç N+1
)

# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ back_populates
user: Mapped["User"] = relationship("User", back_populates="nfts")
```

**–ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ:**
- `lazy='noload'` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è N+1
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ cascade –¥–ª—è –∑–∞–≤–∏—Å–∏–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ back_populates
- Typed annotations –¥–ª—è relationships

### –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã (-1 –±–∞–ª–ª)

#### 1.6 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–∏–±—Ä–∏–¥–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤
```python
# –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
@hybrid_property
def price_tons(self) -> float:
    """–¶–µ–Ω–∞ –≤ TON (–Ω–µ nanotons)"""
    return self.price / 1_000_000_000 if self.price else 0

@hybrid_property
def is_listed(self) -> bool:
    """–í—ã—Å—Ç–∞–≤–ª–µ–Ω –ª–∏ NFT –Ω–∞ –ø—Ä–æ–¥–∞–∂—É"""
    return self.price is not None
```

## 2. –ü—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 2.1 –ó–∞–ø—Ä–æ—Å—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏: +300-500%

**–î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
```sql
-- –ë–µ–∑ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ (user_id, price)
SELECT * FROM nfts WHERE user_id = 123 ORDER BY price DESC;
-- Seq Scan: ~500ms –Ω–∞ 100k –∑–∞–ø–∏—Å–µ–π
```

**–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
```sql
-- –° —Å–æ—Å—Ç–∞–≤–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º ix_nfts_user_price
SELECT * FROM nfts WHERE user_id = 123 ORDER BY price DESC;
-- Index Scan: ~5ms –Ω–∞ 100k –∑–∞–ø–∏—Å–µ–π
```

**–ü—Ä–∏—Ä–æ—Å—Ç: 100x (10000%)**

### 2.2 JOIN –∑–∞–ø—Ä–æ—Å—ã: +200-400%

**–î–æ:**
```sql
-- –ë–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ FK
SELECT n.*, u.username FROM nfts n JOIN users u ON n.user_id = u.id;
-- Hash Join: ~200ms
```

**–ü–æ—Å–ª–µ:**
```sql
-- –° –∏–Ω–¥–µ–∫—Å–∞–º–∏ –Ω–∞ –≤—Å–µ—Ö FK
SELECT n.*, u.username FROM nfts n JOIN users u ON n.user_id = u.id;
-- Nested Loop with Index: ~50ms
```

**–ü—Ä–∏—Ä–æ—Å—Ç: 4x (400%)**

### 2.3 –ß–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã: +150-300%

```python
# –ò–Ω–¥–µ–∫—Å —Ç–æ–ª—å–∫–æ –¥–ª—è NFT —Å —Ü–µ–Ω–æ–π
Index('ix_nfts_price_not_null', 'price', postgresql_where=text('price IS NOT NULL'))
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –†–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–∞: -70% (—Ç–æ–ª—å–∫–æ ~30% –∑–∞–ø–∏—Å–µ–π)
- –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤: +150% –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Ü–µ–Ω–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: -50%

### 2.4 Lazy loading: +100-200%

**–î–æ:**
```python
user = session.get(User, 1)
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ nfts, trades, channels (N+1)
# 1 + N –∑–∞–ø—Ä–æ—Å–æ–≤
```

**–ü–æ—Å–ª–µ:**
```python
user = session.get(User, 1)
# –ù–∏—á–µ–≥–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
# 1 –∑–∞–ø—Ä–æ—Å

# –Ø–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ
user = session.get(User, 1, options=[selectinload(User.nfts)])
# 2 –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ 1+N
```

**–ü—Ä–∏—Ä–æ—Å—Ç: 10x –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å relationships**

### 2.5 –û–±—â–∏–π –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ | –î–æ | –ü–æ—Å–ª–µ | –ü—Ä–∏—Ä–æ—Å—Ç |
|--------------|-----|-------|---------|
| –ü—Ä–æ—Å—Ç—ã–µ SELECT —Å WHERE | 100ms | 5ms | 20x |
| SELECT —Å ORDER BY | 500ms | 10ms | 50x |
| JOIN –∑–∞–ø—Ä–æ—Å—ã | 200ms | 50ms | 4x |
| –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤ —Å relationships | 1000ms | 100ms | 10x |
| INSERT/UPDATE | 10ms | 10ms | 1x |
| –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ | 300ms | 50ms | 6x |

**–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏—Ä–æ—Å—Ç: 15-20x (1500-2000%)**

## 3. –†–∏—Å–∫–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ API handlers

### 3.1 –ù–∏–∑–∫–∏–µ —Ä–∏—Å–∫–∏ (–º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å—Ä–∞–∑—É)

#### –Ø–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ relationships
```python
# –î–æ
@router.get("/users/{user_id}")
async def get_user(user_id: int, db: AsyncSession):
    user = await db.get(User, user_id)
    # user.nfts –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (N+1)
    return user

# –ü–æ—Å–ª–µ
@router.get("/users/{user_id}")
async def get_user(user_id: int, db: AsyncSession):
    stmt = select(User).where(User.id == user_id).options(selectinload(User.nfts))
    result = await db.execute(stmt)
    user = result.scalar_one_or_none()
    return user
```

**–†–∏—Å–∫: 2/10**
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
- –ù–µ –º–µ–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É
- –£–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ú–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ typed queries
```python
# –î–æ
result = await db.execute(text("SELECT * FROM nfts WHERE user_id = :user_id"), {"user_id": user_id})

# –ü–æ—Å–ª–µ
stmt = select(NFT).where(NFT.user_id == user_id)
result = await db.execute(stmt)
nfts = result.scalars().all()
```

**–†–∏—Å–∫: 1/10**
- –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ
- –ê–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- –õ–µ–≥—á–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å

### 3.2 –°—Ä–µ–¥–Ω–∏–µ —Ä–∏—Å–∫–∏ (–Ω—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ lazy loading
```python
# –ú–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É
user = await db.get(User, user_id)
for nft in user.nfts:  # –†–∞–Ω—å—à–µ —Ä–∞–±–æ—Ç–∞–ª–æ, —Ç–µ–ø–µ—Ä—å –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
    print(nft.price)
```

**–†–∏—Å–∫: 5/10**
- –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤—Å–µ –º–µ—Å—Ç–∞ —Å –Ω–µ—è–≤–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π
- –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—ã–µ selectinload/joinedload
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –í—Ä–µ–º–µ–Ω–Ω–æ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å lazy='select' –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö relationships
nfts: Mapped[List["NFT"]] = relationship("NFT", lazy='select')  # –í—Ä–µ–º–µ–Ω–Ω–æ
```

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ nullable –ø–æ–ª–µ–π
```python
# –ï—Å–ª–∏ –∫–æ–¥ –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ NULL –∑–Ω–∞—á–µ–Ω–∏—è
if nft.price is None:  # –†–∞–Ω—å—à–µ —Ä–∞–±–æ—Ç–∞–ª–æ
    # –¢–µ–ø–µ—Ä—å price –≤—Å–µ–≥–¥–∞ int, –º–æ–∂–µ—Ç –±—ã—Ç—å 0
```

**–†–∏—Å–∫: 4/10**
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É —Å nullable –ø–æ–ª—è–º–∏
- –û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
- –ò–∑–º–µ–Ω–∏—Ç—å API responses

### 3.3 –í—ã—Å–æ–∫–∏–µ —Ä–∏—Å–∫–∏ (—Ç—Ä–µ–±—É—é—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏)

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ cascade
```python
# –î–æ: ondelete='SET NULL'
# –ü–æ—Å–ª–µ: ondelete='CASCADE'

# –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º—É —É–¥–∞–ª–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö
await db.delete(user)  # –¢–µ–ø–µ—Ä—å —É–¥–∞–ª–∏—Ç –≤—Å–µ NFT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**–†–∏—Å–∫: 7/10**
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É —É–¥–∞–ª–µ–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å soft delete –≥–¥–µ –Ω—É–∂–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å soft delete –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
class NFT(Base):
    deleted_at: Mapped[Optional[datetime]] = mapped_column(DateTime, nullable=True)
    
    @hybrid_property
    def is_deleted(self) -> bool:
        return self.deleted_at is not None
```

## 4. –ü–ª–∞–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ handlers

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1-2 –¥–Ω—è)
1. –°–æ–∑–¥–∞—Ç—å comprehensive —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
2. –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
3. –°–æ–∑–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–µ—Å—Ç —Å relationships

### –≠—Ç–∞–ø 2: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (1-2 –Ω–µ–¥–µ–ª–∏)
1. **–î–µ–Ω—å 1-2:** –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—ã–µ selectinload/joinedload
2. **–î–µ–Ω—å 3-4:** –ó–∞–º–µ–Ω–∏—Ç—å raw SQL –Ω–∞ typed queries
3. **–î–µ–Ω—å 5-7:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å N+1 –∑–∞–ø—Ä–æ—Å—ã
4. **–î–µ–Ω—å 8-10:** –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
5. **–î–µ–Ω—å 11-14:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ–∏–∫—Å—ã

### –≠—Ç–∞–ø 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (1 –Ω–µ–¥–µ–ª—è)
1. –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å slow queries
2. –ü—Ä–æ–≤–µ—Ä—è—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. –°–æ–±–∏—Ä–∞—Ç—å feedback –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## 5. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 5.1 –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å—Ä–∞–∑—É (–Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫)
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å typed queries –≤–º–µ—Å—Ç–æ raw SQL
‚úÖ –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—ã–µ selectinload –¥–ª—è relationships
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é —Å limit/offset

### 5.2 –ß—Ç–æ –¥–µ–ª–∞—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ (—Å—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫)
‚ö†Ô∏è –ò–∑–º–µ–Ω–∏—Ç—å lazy='noload' –Ω–∞ lazy='select' –≤—Ä–µ–º–µ–Ω–Ω–æ
‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ nullable –ø–æ–ª—è
‚ö†Ô∏è –û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ serializers
‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å integration —Ç–µ—Å—Ç—ã

### 5.3 –ß—Ç–æ –æ—Ç–ª–æ–∂–∏—Ç—å (–≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫)
üî¥ –ò–∑–º–µ–Ω–µ–Ω–∏–µ cascade –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
üî¥ –£–¥–∞–ª–µ–Ω–∏–µ deprecated –ø–æ–ª–µ–π
üî¥ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã relationships
üî¥ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ production –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## 6. –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –°—Ä–µ–¥–Ω–∏–π response time < 100ms (—Å–µ–π—á–∞—Å ~500ms)
- [ ] 95 –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å < 200ms (—Å–µ–π—á–∞—Å ~1000ms)
- [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ slow queries < 1% (—Å–µ–π—á–∞—Å ~10%)
- [ ] N+1 –∑–∞–ø—Ä–æ—Å—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã (—Å–µ–π—á–∞—Å –µ—Å—Ç—å)

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- [ ] Type coverage > 95% (—Å–µ–π—á–∞—Å ~60%)
- [ ] Test coverage > 90% (—Å–µ–π—á–∞—Å ~70%)
- [ ] –ù–µ—Ç mypy –æ—à–∏–±–æ–∫ (—Å–µ–π—á–∞—Å –µ—Å—Ç—å)
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π (‚úÖ –≥–æ—Ç–æ–≤–æ)

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- [ ] –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ù–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ù–µ—Ç —É–≤–µ–ª–∏—á–µ–Ω–∏—è error rate
- [ ] –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π feedback –æ—Ç –∫–æ–º–∞–Ω–¥—ã

## 7. –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

### –ö–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π: 9/10
–ú–æ–¥–µ–ª–∏ –æ—Ç–ª–∏—á–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ, —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ, —Ö–æ—Ä–æ—à–æ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ.

### –ü—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: 15-20x
–û–≥—Ä–æ–º–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –∑–∞ —Å—á–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ relationships.

### –†–∏—Å–∫ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ handlers: 4/10 (—Å—Ä–µ–¥–Ω–∏–π)
–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ —Ä–∏—Å–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã. –ì–ª–∞–≤–Ω–æ–µ - –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ—Å—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: ‚úÖ –î–ï–õ–ê–¢–¨
–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ handlers —Å—Ç–æ–∏—Ç –¥–µ–ª–∞—Ç—å, –Ω–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∏ —Å —Ç—â–∞—Ç–µ–ª—å–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
