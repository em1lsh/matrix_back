# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥-—Ç–µ—Å—Ç—ã (ref_tests)

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–¶–µ–ª—å](#—Ü–µ–ª—å)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [–ó–∞–ø—É—Å–∫](#–∑–∞–ø—É—Å–∫)
- [–ü—Ä–∏–Ω—Ü–∏–ø—ã](#–ø—Ä–∏–Ω—Ü–∏–ø—ã)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
pytest backend/tests/ref_tests/ -v

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç
cd backend/tests
./run_ref_tests.sh  # Linux/Mac
run_ref_tests.bat   # Windows
```

---

## üéØ –¶–µ–ª—å

–≠—Ç–∏ —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è **–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ—Ö API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ**.

–ö–∞–∂–¥—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–∫—Ä—ã—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∏–º —Ç–µ—Å—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. ‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å 200 (–∏–ª–∏ –æ–∂–∏–¥–∞–µ–º—ã–π —Å—Ç–∞—Ç—É—Å –æ—à–∏–±–∫–∏)
2. ‚úÖ –ë–∞–∑–æ–≤–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚úÖ –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º

**–≠—Ç–æ –ù–ï –∑–∞–º–µ–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–º —Ç–µ—Å—Ç–∞–º**, –∞ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
ref_tests/
‚îú‚îÄ‚îÄ README.md                    # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ COVERAGE.md                  # –î–µ—Ç–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
‚îú‚îÄ‚îÄ BEST_PRACTICES.md            # –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ USAGE_EXAMPLES.md            # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ COMPARISON.md                # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏
‚îÇ
‚îú‚îÄ‚îÄ test_ref_users.py           # 4 —Ç–µ—Å—Ç–∞ –¥–ª—è /api/users/*
‚îú‚îÄ‚îÄ test_ref_accounts.py        # 3 —Ç–µ—Å—Ç–∞ –¥–ª—è /api/accounts/*
‚îú‚îÄ‚îÄ test_ref_market.py          # 9 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è /api/market/*
‚îú‚îÄ‚îÄ test_ref_nft.py             # 7 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è /api/nft/*
‚îú‚îÄ‚îÄ test_ref_auctions.py        # 6 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è /api/auctions/*
‚îú‚îÄ‚îÄ test_ref_channels.py        # 8 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è /api/channels/*
‚îú‚îÄ‚îÄ test_ref_offers.py          # 5 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è /api/offers/*
‚îú‚îÄ‚îÄ test_ref_presale.py         # 5 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è /api/presales/*
‚îî‚îÄ‚îÄ test_ref_trades.py          # 13 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è /api/trade/*
```

**–í—Å–µ–≥–æ**: 60 —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç ~60 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (100% –ø–æ–∫—Ä—ã—Ç–∏–µ)

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –î–æ–∫—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| [COVERAGE.md](COVERAGE.md) | –î–µ—Ç–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø–æ –º–æ–¥—É–ª—è–º |
| [BEST_PRACTICES.md](BEST_PRACTICES.md) | –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ |
| [USAGE_EXAMPLES.md](USAGE_EXAMPLES.md) | –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –∫–æ–º–∞–Ω–¥—ã, CI/CD |
| [COMPARISON.md](COMPARISON.md) | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å test_heavy_endpoints –∏ –¥—Ä—É–≥–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏ |

---

## üèÉ –ó–∞–ø—É—Å–∫

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –í—Å–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥-—Ç–µ—Å—Ç—ã
pytest backend/tests/ref_tests/ -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–¥—É–ª—å
pytest backend/tests/ref_tests/test_ref_market.py -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest backend/tests/ref_tests/test_ref_market.py::TestRefMarket::test_get_salings_200 -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest backend/tests/ref_tests/ --cov=app/api/routers --cov-report=html
```

### –°–∫—Ä–∏–ø—Ç—ã
```bash
# Linux/Mac
cd backend/tests
chmod +x run_ref_tests.sh
./run_ref_tests.sh

# Windows
cd backend\tests
run_ref_tests.bat
```

### –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
pytest backend/tests/ref_tests/ -x --tb=short

# –¢–æ–ª—å–∫–æ —É–ø–∞–≤—à–∏–µ —Ç–µ—Å—Ç—ã
pytest backend/tests/ref_tests/ --lf -v
```

–ë–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ [USAGE_EXAMPLES.md](USAGE_EXAMPLES.md)

---

## üí° –ü—Ä–∏–Ω—Ü–∏–ø—ã

### 1. –ú–∏–Ω–∏–º–∞–ª–∏–∑–º
–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—É—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å, –Ω–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

```python
# ‚úÖ –•–æ—Ä–æ—à–æ
assert response.status_code == 200
assert isinstance(data, list)

# ‚ùå –ü–ª–æ—Ö–æ (—Å–ª–∏—à–∫–æ–º –¥–µ—Ç–∞–ª—å–Ω–æ)
assert len(data) == 10
assert data[0]["price"] == 1000000000
```

### 2. –ò–∑–æ–ª—è—Ü–∏—è
–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ ID.

```python
gift_id = generate_unique_id()
account_id = f"test_acc_{secrets.token_hex(4)}"
```

### 3. –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
–¢–µ—Å—Ç—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç–æ–≤.

```python
# ‚úÖ –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
async def test_delete_auction(self, ...):
    # –°–æ–∑–¥–∞–µ–º —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
    auction = models.Auction(...)
    db_session.add(auction)
    await db_session.commit()
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º
    response = await client.delete(...)
```

### 4. –ü–æ–∫—Ä—ã—Ç–∏–µ
–ö–∞–∂–¥—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –ø–æ–∫—Ä—ã—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∏–º —Ç–µ—Å—Ç–æ–º –Ω–∞ —É—Å–ø–µ—à–Ω—ã–π –∫–µ–π—Å (200).

–°–º. –¥–µ—Ç–∞–ª–∏ –≤ [COVERAGE.md](COVERAGE.md)

---

## ‚ùå –ß—Ç–æ –ù–ï —Ç–µ—Å—Ç–∏—Ä—É–µ–º

- ‚ùå –°–ª–æ–∂–Ω—ã–µ edge cases ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `test_heavy_endpoints.py`
- ‚ùå –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `load/` —Ç–µ—Å—Ç—ã
- ‚ùå –î–µ—Ç–∞–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ unit —Ç–µ—Å—Ç—ã
- ‚ùå –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `test_security.py`

–°–º. —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤ [COMPARISON.md](COMPARISON.md)

---

## üîÑ Workflow –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –î–û —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
pytest backend/tests/ref_tests/ -v
# ‚úÖ –í—Å–µ –∑–µ–ª–µ–Ω–æ–µ

# 2. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
# ... –º–µ–Ω—è–µ–º –∫–æ–¥ ...

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –ü–û–°–õ–ï —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
pytest backend/tests/ref_tests/ -v
# ‚úÖ –í—Å–µ –∑–µ–ª–µ–Ω–æ–µ ‚Üí —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω
# ‚ùå –ï—Å—Ç—å –æ—à–∏–±–∫–∏ ‚Üí –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤**: ~60
- **–ü–æ–∫—Ä—ã—Ç–æ —Ç–µ—Å—Ç–∞–º–∏**: 60
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: 100%
- **–§–∞–π–ª–æ–≤ —Å —Ç–µ—Å—Ç–∞–º–∏**: 9
- **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~30 —Å–µ–∫—É–Ω–¥

---

## ü§ù –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–µ—Å—Ç

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏ –µ–≥–æ –º–æ–¥—É–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/api/market/new-endpoint`)
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª (`test_ref_market.py`)
3. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç –ø–æ —à–∞–±–ª–æ–Ω—É:

```python
@pytest.mark.asyncio
async def test_new_endpoint_200(self, client: AsyncClient, test_token):
    """GET /api/market/new-endpoint - –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ"""
    response = await client.get(
        "/api/market/new-endpoint",
        params={"token": test_token}
    )
    assert response.status_code == 200
    data = response.json()
    assert "expected_field" in data
```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç: `pytest backend/tests/ref_tests/test_ref_market.py::TestRefMarket::test_new_endpoint_200 -v`
5. –û–±–Ω–æ–≤–∏—Ç–µ [COVERAGE.md](COVERAGE.md)

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ [BEST_PRACTICES.md](BEST_PRACTICES.md)

---

## üÜö –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏

| –¢–∏–ø | –¶–µ–ª—å | –°–∫–æ—Ä–æ—Å—Ç—å | –ü–æ–∫—Ä—ã—Ç–∏–µ |
|-----|------|----------|----------|
| **ref_tests** | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ | ‚ö° –ë—ã—Å—Ç—Ä–æ | 100% —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ |
| test_heavy_endpoints | –î–µ—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ | üêå –ú–µ–¥–ª–µ–Ω–Ω–æ | –¢–æ–ª—å–∫–æ —Ç—è–∂–µ–ª—ã–µ |
| test_models | –ú–æ–¥–µ–ª–∏ –ë–î | ‚ö° –ë—ã—Å—Ç—Ä–æ | –ú–æ–¥–µ–ª–∏ |
| load —Ç–µ—Å—Ç—ã | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | üêå –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ | –ü—É–±–ª–∏—á–Ω—ã–µ API |

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ [COMPARISON.md](COMPARISON.md)

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã:
1. –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ [BEST_PRACTICES.md](BEST_PRACTICES.md)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –≤ [USAGE_EXAMPLES.md](USAGE_EXAMPLES.md)
3. –°—Ä–∞–≤–Ω–∏—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏ –≤ [COMPARISON.md](COMPARISON.md)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –≤ [COVERAGE.md](COVERAGE.md)

---

## üìù Changelog

- **2025-12-03**: –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ ref_tests —Å 60 —Ç–µ—Å—Ç–∞–º–∏
- **2025-12-03**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (README, COVERAGE, BEST_PRACTICES, USAGE_EXAMPLES, COMPARISON)
- **2025-12-03**: –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞ (run_ref_tests.sh, run_ref_tests.bat)

---

**–°–æ–∑–¥–∞–Ω–æ**: 2025-12-03  
**–¶–µ–ª—å**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è API –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ  
**–ü–æ–∫—Ä—ã—Ç–∏–µ**: 100% —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (60/60)
